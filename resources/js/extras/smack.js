/**
 * Smack Compiler v0.0.1
 *
 * Copyright 2011, Brandon Fryslie
 * Released under the MIT License
 */
this.Smack=function(){function require(a){return require[a]}return require["./AST"]=new function(){var a=this;((function(){var b,c,d,e,f,g,h,i,j,k,l=Object.prototype.hasOwnProperty,m=function(a,b){function d(){this.constructor=a}for(var c in b)l.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},n=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(l.call(this,b)&&this[b]===a)return b;return-1};typeof module!="undefined"&&module!==null&&(k=require("./Helper")._h),h=["area","base","br","col","command","embed","hr","img","input","link","meta","param","source"],c={"#":"id",".":"class"},b={iframe:'iframe style="width:0;height:0;" src=""'},a.Node=g=function(){function a(a){this.nodes=a!=null?a:[]}return a.prototype.push=function(a){return this.nodes.push(a)},a}(),a.Body=d=function(){function a(){a.__super__.constructor.apply(this,arguments)}return m(a,g),a.prototype.compile=function(){var a;return function(){var b,c,d,e;d=this.nodes,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.compile());return e}.call(this).join("")},a}(),a.SmackBlock=i=function(){function a(a,b,c,d){this.front_op=a,this.zentag=b,this.literal=c,this.rear_op=d}return m(a,g),a.prototype.compile=function(){var a,b,c,d;return d=this.zentag.compile(),b=d[0],a=d[1],c=d[2],""+b+c+this.literal+(c!==""?"\n":void 0)+a},a}(),a.ZenTag=j=function(){function a(a){this.tags=[{op:">",tag:a}]}return m(a,g),a.prototype.add=function(a,b){return this.tags.push({op:b})},a.prototype.compile=function(){var a,b,c,d,e,f,g,i,j,l,m,o,p,q,r;m=[],l=[],e=0,g=e!==-1,q=this.tags;for(o=0,p=q.length;o<p;o++){r=q[o],f=r.op,j=r.tag,l.push(g?k.indent(e)+j.compile()+"\n":j.compile());switch(f){case">":m.push(j.el),e++;break;case"+":m.splice(-1,0,j.el)}}return b=e+1,d=l.join(""),a=function(){var a;a=[];while(i=m.pop())if(n.call(h,i)<0)g||"</"+i+">",a.push(k.indent(--e)+("</"+i+">\n"));else continue;return a}(),c=a.join(""),[d,c,g?k.indent(b):""]},a}(),a.HtmlTag=e=function(){function a(a,b,c){this.el=a,this.abbreviated=b,this.attributes=c}return m(a,g),a.prototype.compile=function(){var a,b,d,e,f,g,h,i,j,l,m,n,o,p,q;b={},n=this.attributes;for(i=0,l=n.length;i<l;i++)o=n[i],f=o.key,h=o.value,b[f]=h;p=this.abbreviated;for(j=0,m=p.length;j<m;j++)q=p[j],f=q.key,h=q.value,f=c[f],b[f]!=null&&f==="class"?b[f]+=" "+h:b[f]=h;return d=k.join(function(){var a;a=[];for(e in b)g=b[e],(e==="id"||e==="class")&&a.push(" "+e+'="'+g+'"');return a}()),a=k.join(function(){var a;a=[];for(e in b)g=b[e],e!=="id"&&e!=="class"&&a.push(" "+e+'="'+g+'"');return a}()),b==null&&"<"+this.el+">","<"+this.el+d+a+">"},a}(),a.Literal=f=function(){function a(a){this.value=a}return m(a,g),a.prototype.compile=function(){return""+this.value},a}()})).call(this)},require["./Lexer"]=new function(){var a=this;((function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;i=function(){function a(){}return a.prototype.TEST={MAIN:0,OPENTAG:0,WHITESPACE:0,FOR_TOKENS:0,ELEMENT:0,LITERAL:0},a.prototype.tokenize=function(a){var b,c,d,e,f;((d=this.TEST)!=null?d.MAIN:void 0)&&console.log("tokenizing code: "+a),this.code=a.replace(/\r/g,""),this.line=0,this.tokens=[],b=0;while(this.chunk=this.code.slice(b))((e=this.TEST)!=null?e.MAIN:void 0)&&console.log("main@in_config(): "+this.in_config()),c=function(a,b){return a[0]==="OPENTAG"?b:a},this.for_tokens(function(){return c}),((f=this.TEST)!=null?f.MAIN:void 0)&&console.log(this.chunk),b+=this.OpenTag()||this.SmackOperator()||this.Midtag()||this.CloseTag()||this.Element()||this.AttributeAbbreviation()||this.AttributeList()||this.ZenOperator()||this.Literal()||this.Whitespace()||this.LexerError();return this.closeTags(),this.tokens},a.prototype.closeTags=function(){return"</div>"},a.prototype.for_tokens=function(a){var b,c,d,e,f,g,h=this;((e=this.TEST)!=null?e.FOR_TOKENS:void 0)&&console.log("@for_tokens:"),((f=this.TEST)!=null?f.FOR_TOKENS:void 0)&&console.log(this.tokens),d=null,c=null,b=this.tokens.length,g=[];while(b--){if(c!=null)return c;g.push(function(b,c){var d,e,f,g,i;i=e=h.tokens[b],d=i[0],g=i[1],f=a(arguments);if((f!=null?f.length:void 0)>0&&(f!=null?f[0]:void 0)==="return")return f.length>1?f[1]:f.slice(1)}(b,d))}return g},a.prototype.is_reverse=function(){return this.last_operator===" "},a.prototype.in_tag=!1,a.prototype._in_config=!1,a.prototype.in_config=function(){return this.in_tag&&this._in_config},a.prototype.last=function(a,b){return a[a.length-(b||0)-1]},a.prototype.tag=function(a,b){var c;return(c=this.last(this.tokens,a))&&(b?c[0]=b:c[0])},a.prototype.value=function(a,b){var c;return(c=this.last(this.tokens,a))&&(b?c[1]=b:c[1])},a.prototype.check_status=function(){return{"In tag?":this.in_tag,"In tag config":this.in_config(),"reverse?":this.is_reverse(),"tag()":this.tag(),chunk:this.chunk}},a.prototype.OpenTag=function(){var a,b,c,d,e,f;return((c=this.TEST)!=null?c.OPENTAG:void 0)&&console.log("Opentag w/ chunk:"+this.chunk),((d=this.TEST)!=null?d.OPENTAG:void 0)&&console.log("Opentag RE:"+l),(a=l.exec(this.chunk))?(((e=this.TEST)!=null?e.OPENTAG:void 0)&&console.log("Opentag matched"),f=a,a=f[0],b=f[1],this.tokens.push(["OPENTAG",b]),this.in_tag=!0,this._in_config=!0,a.length):0},a.prototype.SmackOperator=function(){var a;return!this.tag()||this.tag()!=="OPENTAG"||!(a=o.exec(this.chunk))?0:(this.tokens.push(["SMACK_OPERATOR",a[0]]),this.last_operator=a[0],this._in_config=a[0]!==" ",a[0].length)},a.prototype.Midtag=function(){var a,b,c;return!this.in_tag||!(a=j.exec(this.chunk))?0:(c=a,a=c[0],b=c[1],this.tokens.push(["MIDTAG",b]),this._in_config=!this.in_config(),a.length)},a.prototype.CloseTag=function(){var a,b,c,d;return!this.in_tag||this.tag()!=="LITERAL"&&!this.in_config()||!(a=f.exec(this.chunk))?0:(d=a,a=d[0],b=d[1],c=d[2],this.tokens.push(["SMACK_OPERATOR",b]),this.tokens.push(["CLOSETAG",c]),this.in_tag=!1,this._in_config=!1,a.length)},a.prototype.Element=function(){var a,b,c,d;return!this.in_config()||!(a=h.exec(this.chunk))?0:(d=a,a=d[0],c=d[1],b=d[2],this.tokens.push(["ELEMENT",a]),a.length)},a.prototype.AttributeAbbreviation=function(){var a,c,d,e;return!this.in_config()||!(c=b.exec(this.chunk))?0:(e=c,c=e[0],a=e[1],d=e[2],this.tokens.push(["ABBREVIATED_ATTRIBUTE",{key:a,value:d}]),c.length)},a.prototype.AttributeList=function(){var a,b,c,e,f,g,h,i;if(!this.in_config()||!(c=d.exec(this.chunk)))return 0;this.tokens.push(["ATTR_LIST_OPEN",c[1]]),h=c[2].split(",");for(f=0,g=h.length;f<g;f++)a=h[f],i=a.split(/:\s/),b=i[0],e=i[1],this.tokens.push(["ATTRIBUTE",{key:b,value:e}]);return this.tokens.push(["ATTR_LIST_CLOSE",c[3]]),c[0].length},a.prototype.ZenOperator=function(){var a,b,c,d,e;return(a=s.exec(this.chunk))?(d=a,a=d[0],c=d[1],b=d[2],((e=this.TEST)!=null?e.ZENOP:void 0)&&console.log("zenop"),this.tokens.push(["ZEN_OPERATOR",a]),a.length):0},a.prototype.SmackVariable=function(){var a,b,c,d,e;return(a=q.exec(this.chunk))?(d=a,a=d[0],c=d[1],b=d[2],((e=this.TEST)!=null?e.SMACKVAR:void 0)&&console.log("smackvar"),this.tokens.push(["SMACK_VARIABLE",a]),a.length):0},a.prototype.SmackAlias=function(){var a,b,c,d,e;return(a=n.exec(this.chunk))?(d=a,a=d[0],c=d[1],b=d[2],((e=this.TEST)!=null?e.SMACKALIAS:void 0)&&console.log("alias"),this.tokens.push(["SMACK_ALIAS",a]),a.length):0},a.prototype.Literal=function(){var a,b,c,d,e,f,h,i,j,l;return this.in_config()||this.tag()==="LITERAL"?0:(c=(e=(f=m.exec(this.chunk))!=null?f.index:void 0)!=null?e:this.chunk.length,d=!this.is_reverse()&&this.tag()==="MIDTAG"?a=(h=(i=g.exec(this.chunk))!=null?i.index:void 0)!=null?h:this.chunk.length:this.is_reverse&&this.tag()==="SMACK_OPERATOR"&&this.value()===" "?a=(j=(l=k.exec(this.chunk))!=null?l.index:void 0)!=null?j:this.chunk.length:void 0,d?(b=this.chunk.slice(0,d),this.tokens.push(["LITERAL",b]),b.length):0)},a.prototype.Whitespace=function(){var a;return(a=r.exec(this.chunk))?a[0].length:0},a.prototype.LexerError=function(){var a;try{throw null}catch(b){throw console.log("--- ERRROR ---"),console.log("Not a token: "+this.chunk),console.log("@tokens"),console.log(this.tokens),"Fix your lexers"}return a=this.chunk[0],this.tokens.push(["TOKEN",a]),a.length},a}(),h=/^[a-zA-Z][a-zA-Z0-9]*/,b=/^([#.]+)([a-zA-Z][a-zA-Z0-9\-_]*)/,c=/^[a-zA-Z][a-zA-Z0-9\-_]*/,e=/^[a-zA-Z_ ][\-a-zA-Z0-9_ .]*/,d=/^(\|)([\s\S]*?)(\|)/,r=/^\s+/,o=/^([\S]*?>|\x20)/,p=/([\S]*?>|\x20)/,n=/^@[a-zA-Z0-9_\-$]+/,q=/^$([a-zA-Z0-9_$]+)|${?([a-zA-Z0-9_$\[\].]+)}/,s=/^[>+]/,l=/^(~[|])/,m=/(~[|])/,f=/^(~>[\S]*?|\x20)([|]~)/,g=/(~>[\S]*?|\x20)([|]~)/,j=/^(~[\s]|[\s]~(?!>))/,k=/(~[\s]|[\s]~(?!>))/,a.Lexer=i})).call(this)},require["./Parser"]=new function(){var a=this;((function(){var b,c,d,e,f,g,h,i,j,k;b=require("jison").Parser,k=/^function\s*\(\)\s*\{\s*return\s*([\s\S]*);\s*\}/,g=function(a,b,c){var d;return a=a.replace(/\s{2,}/g," "),b?(b=(d=k.exec(b))?d[1]:"("+b+"())",b=b.replace(/\bnew /g,"$&yy."),b=b.replace(/\b(?:Block\.wrap|extend)\b/g,"yy.$&"),[a,"$$ = "+b+";",c]):[a,"$$ = $1;",c]},e={Root:[g("",function(){return new Body}),g("Body")],Body:[g("Expression",function(){return new Body([$1])}),g("Body Expression",function(){return $1.push($2)})],Expression:[g("SmackBlock")],SmackBlock:[g("OPENTAG SMACK_OPERATOR SmackTagConfig MIDTAG LITERAL SMACK_OPERATOR CLOSETAG",function(){return new SmackBlock($2,$3,$5,$6)}),g("OPENTAG SMACK_OPERATOR LITERAL MIDTAG SmackTagConfig SMACK_OPERATOR CLOSETAG",function(){return new SmackBlock($2,$5,$3,$6)})],SmackTagConfig:[g("ZenTag")],ZenTag:[g("HtmlTag",function(){return new ZenTag($1)}),g("ZenTag ZEN_OPERATOR HtmlTag",function(){return $1.tags.push({op:$2,tag:$3}),$1})],HtmlTag:[g("ELEMENT AbbreviatedAttributeList AttributeList",function(){return new HtmlTag($1,$2,$3)})],AbbreviatedAttributeList:[g("",function(){return[]}),g("AbbreviatedAttributes",function(){return $1})],AbbreviatedAttributes:[g("ABBREVIATED_ATTRIBUTE",function(){return[$1]}),g("AbbreviatedAttributes ABBREVIATED_ATTRIBUTE",function(){return $1.concat($2)})],AttributeList:[g("",function(){return[]}),g("ATTR_LIST_OPEN Attributes ATTR_LIST_CLOSE",function(){return $2})],Attributes:[g("ATTRIBUTE",function(){return[$1]}),g("Attributes ATTRIBUTE",function(){return $1.concat($2)})]},h=[],j=[];for(f in e)d=e[f],e[f]=function(){var a,b,f,g,h,k;k=[];for(a=0,f=d.length;a<f;a++){c=d[a],h=c[0].split(" ");for(b=0,g=h.length;b<g;b++)i=h[b],e[i]||j.push(i);k.push(c)}return k}();a.parser=new b({tokens:j.join(" "),bnf:e,operators:h.reverse(),startSymbol:"Root"})})).call(this)},require["./Helper"]=new function(){var a=this;((function(){var b;b=a.extend=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},a._h={escape_html:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},unescape_html:function(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")},escape_reg_exp:function(a){return a.replace(/([-.*+?^${}()|\[\]\/\\])/g,"\\$1")},trim:function(a,b){return b==null&&String.prototype.trim!=null?String.prototype.trim.call(str):a.replace(/^\s+|\s+$/g,"")},join:function(a,b){b==null&&(b="");if(a instanceof Array)return a.join(b);throw"_h.join: not an array, brah-man!"},indent:function(a,b){return b==null&&(b="  "),Array(a+1).join(b)}}})).call(this)},require["./Smack"]=new function(){var a=this;((function(){var b,c,d,e;b=require("./Lexer").Lexer,e=require("./Parser").parser,a.VERSION="0.0.1",d=new b,e.lexer={lex:function(){var a,b;return b=this.tokens[this.pos++]||[""],a=b[0],this.yytext=b[1],a},setInput:function(a){return this.tokens=a,this.pos=0},upcomingInput:function(){return""}},a.compile=c=function(a,b){b==null&&(b={});try{return console.log(e.parse(d.tokenize(a))),e.parse(d.tokenize(a)).compile(b)}catch(c){throw b.filename&&(c.message="In "+b.filename+", "+c.message),c}},a.tokens=function(a,b){return d.tokenize(a,b)},a.nodes=function(a,b){return typeof a=="string"?e.parse(d.tokenize(a,b)):e.parse(a)},e.yy=require("./AST")})).call(this)},require["./Browser"]=new function(){var exports=this;((function(){var Smack,runScripts;Smack=require("./Smack"),Smack.require=require,Smack.eval=function(code,options){return eval(Smack.compile(code,options))},Smack.run=function(a,b){return b==null&&(b={}),b.bare=!0,Function(Smack.compile(a,b))()};if(typeof window=="undefined"||window===null)return;Smack.load=function(a,b){var c;return c=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP"),c.open("GET",a,!0),"overrideMimeType"in c&&c.overrideMimeType("text/plain"),c.onreadystatechange=function(){var d;if(c.readyState===4){if((d=c.status)===0||d===200)Smack.run(c.responseText);else throw new Error("Could not load "+a);if(b)return b()}},c.send(null)},runScripts=function(){var a,b,c,d,e,f;return e=document.getElementsByTagName("script"),f=function(){var a,b,c;c=[];for(a=0,b=e.length;a<b;a++)d=e[a],d.type==="text/smack"&&c.push(d);return c}(),b=0,c=f.length,(a=function(){var c;c=f[b++];if((c!=null?c.type:void 0)==="text/Smack")return c.src?Smack.load(c.src,a):(Smack.run(c.innerHTML),a())})(),null},window.addEventListener?addEventListener("DOMContentLoaded",runScripts,!1):attachEvent("onload",runScripts)})).call(this)},require["./smack"]}()